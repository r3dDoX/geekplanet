sudo: required

services:
- docker
- heroku

env:
  global:
  - secure: f6RQRRQ9SbGVXtrCLBvZ7xHgGybslFLmdSIo5zsDzJaAVjZP2rUAI+RT6XGhgvOgBOZaRgydSKfmKnKFfHOsi6J6O0mAsSjXOMy5OtLvX1bmivq8i+wOJR+NOCSQnH12Lh/Iwxrcyskq52T+Tmx0EiEPQWAJFQD8ER0LlTZxv4GZ/rXptixsknzKZeMOELG98U8jsL9jCwcJ8Hmr/6sC5v5jV0Qcl4NI8lx9pmas4nACXEYeBwKMBMJQZDqR0ODbS/C8ryL4jmb3ByX3ko4Qpm0GVRUqfNCOWQt2QegVrYmnH6FP+n3uWWBrjUJgjqeuQVhwO7tddQRrjEXpVCL5KXFkB6Cg2crWZRK87+OXADV9k9cFbxouixZny7HsHjEi8Ww3mSetTzQQO/iVBRTsAIIzPpa6cWoXmeUfXCX+2lhLSDKJy0JtyXfeRYr00oKm+HDpFYOWemFrNVNyKlPVLhlQHWeb7shnrae+sZTgcnjsxKp5vJ+eZSXkGvjhYCWkdyR0aoQltbQFJOMULPXsNzlQMtOlOE5kCwsgf1AWmf8i4y4KP1DTnxR+q5wTsD7M9SSYhayLqZd4nb/9oTIlXaSxmixuZYyqDOsgSQskarRuaBQX2neQcAVdP+PGWAhOKni81UITGbnuu5OKUkojtN1MFa1ho2TuiCu/BtNufhA=
  - secure: NQETqFfk/kx5SZ5HhWWor2wv+HA2sBvXfwrdvVaPhcgq1+TfnPaU0KvBKvKgLDJa+dydBLh/pAP4EdzlFs6fUe+mh4UhO9FrZLDBf7RF6MfyKGtnhOJcvBmeAnwVwCDb2KQqeiNJYDtLi7fHDrG/9h3KLU+vJbqUbw1Zj1LrHVahpFCnmzRr8mGr82ICk90UyA6kETArugiGVaGqihoKFSK17LIZugs8OBVgQSSSy9BcenKByunMHwJwndNAdNJmye22kr9EMJAv7Z/CfGW8YyDb2IKeq5uFVRKoVx1Z3xFWWuV7JMlfD1008fdV9CylYbGZ38nsX8ZiD0c/09h8D5doC4yEtIt1qCvDJHChdTsnngda8Uu3BUGV3ObLWc6DVfyB68j9w+Sd94loO4hBns9EGPMpX7U98TR/0aJ2aE2rnSTL/kwHSFr1XYzkc5JL0E81xqRQMA2Ctk0TTG6NYIxvGnQ+zEKKfonQpuEhTH8MfXPLDpHnPBtrrNMySJwhDRIt4d4uaQQ+KG6TP/1HIhph7ieiKDXc67uNA7wxTOYKbDKto1sL7p9n+jCi9K3X4ogfGp5EO5aWKeWpDjtT55qvB6yh6nIs8GSsO2ALlYBd/BtcgrT81T4lrASUJ497XJCdPs/YFZeP9Mwkp6fOw0hZivIYHii1fSTvWdFtN3U=

before_install: docker run -it -v "$(pwd)":/usr/app -w /usr/app r3ddox/node-pdftk:10.7.0 npm i

before_script: docker run -it -v "$(pwd)":/usr/app -w /usr/app --env-file <(env | grep TRAVIS) r3ddox/node-pdftk:10.7.0 sh -c "npm i -g greenkeeper-lockfile && greenkeeper-lockfile-update"

after_script: docker run -it -v "$(pwd)":/usr/app -w /usr/app --env GH_TOKEN=$GH_TOKEN --env-file <(env | grep TRAVIS) r3ddox/node-pdftk:10.7.0 sh -c "npm i -g greenkeeper-lockfile && greenkeeper-lockfile-upload"

script:
- docker run -it -v "$(pwd)":/usr/app -w /usr/app r3ddox/node-pdftk:10.7.0 npm test

deploy:
  - provider: script
    script: scripts/deploy-staging.sh $HEROKU_TOKEN
    skip_cleanup: true
    on:
      branch: feature/homescreen
  - provider: script
    script: scripts/deploy.sh $HEROKU_TOKEN
    skip_cleanup: true
    on:
      tags: true
