sudo: required

services:
- docker
- heroku

env:
  global:
  - secure: NqQ/yNyGuPHP1u/1kLcUMyuv/QaXv1tzLv5KFindZFiPflGQEtl37x/atVE2uxfPvQT0uYfvqpPSag+fXfCQzhY1adKNqQAkbPzoUhaASncohpOTTT6KF5eBwn8cu5n0hwPEyhtKsJNTzza9OuDwFOdxpLCmey2gu3NihhWMcEkimTXTZu+T8CBYE4lqRqAzRr38XFKq+uCdYvLewY2S2phpjYo3uBGgXqu4jGdCMIB5Xnw54CYXZVOuVKoAzq7Qij0kRePWW9NJqw6fJDKmxi2T0vXKUxMk0LslUUk9pXe2KFNLk8rYeHQwIVnfzqWLFAtE4QkqnXLwcTIYTA4yrU3Hh1bvfnzD5DPRYV7Hk5rSnUdtBq8qUZcKQMHV1Ln+idxVSENJ1N1zQcvs2zgU/I7JqTFbf3ksW72auA9+P3jwS3NyYud9TFhtNV4aGlaVE6dpiKO0wiTuPyO5NuwHP1w50q7H6y68fvovHyAsYQdTQcy5VQRmE+jbVixMW0XMoxooYHT3DvhsOMPcHWzmSHvsZgnhSPrYV4odyHOQCoqNPZxtqmVslVvl6U0lS2t0vw79AjV/RRREvo/FGLVkp3/h04S/QnKBAsGdtZEcwVqWHou1yn11b76pA2Fn01aCTJDusMwolMLgK+1p6nPJJE4aW5OgEK4QTy8UXxTjBAQ=
  - secure: BJUq+bmZE8iGqS7vviNWj+P/fiitLD5U66Y2TL7XTx6NXP5c+bzTdjBf/5ZfbvvoN518aOMvdUiPkpG8OxK1SGy+XzVmLAztv3MbroEet8XsAZn7Jm4IFo8DkSD//jTZnQqlcyas2yFMpeIbodVVfn9Wm79DbxvR0kuiwg8AdQq10A9u4MgG6IvDX5Hyia7Q2GPyXtZgm5h1JcPd2AgbU5qUIzcZqnj0ERdzLLyCR0RZl0kfq+3tXqEz21PfM0Twfefc3wCQDhS1qtKxv4iqZ+RdAeQVMdtTZcAt9prhKyNPCIIUd5iokBhRHtImIkzcv5AihXeUqDq8BUYpa4Xn8sNi3kwEcaJvqJzI9SI8tVULZeY6LXMoTOInc0gVuMZudTAI46yzb8NcmuN1HfsIpG4eUy4dqfFBWknd5jBV2f/dYhmkBoIpk3idMmIwEY1g6W71h5FKO7P3YhXA58x6LkQb1g3M2QDA43eZF74/Sl+/Gw8F//DvtwQr0rn9MnTiSZWO/Z+NmjJJcgWYNyJdGPr2jFatlPktHuDuFA76Tuj+7E+Ie5hEJocPBxM2QhscYPVqYY5LNkf2tC9xkGXwtPEZKmek+b2mttJuga/2jMzIQcdrJZ5OI5LJIu7cto73Z5wNWqKq8AH2wnahwhdp2XtpF/ETqpeCshRf73D2vH8=

before_install: docker run -it -v "$(pwd)":/usr/app -w /usr/app r3ddox/node-pdftk:10.9.0 npm i

before_script: docker run -it -v "$(pwd)":/usr/app -w /usr/app --env-file <(env | grep TRAVIS) r3ddox/node-pdftk:10.9.0 sh -c "npm i -g greenkeeper-lockfile && greenkeeper-lockfile-update"

after_script: docker run -it -v "$(pwd)":/usr/app -w /usr/app --env GH_TOKEN=$GH_TOKEN --env-file <(env | grep TRAVIS) r3ddox/node-pdftk:10.9.0 sh -c "npm i -g greenkeeper-lockfile && greenkeeper-lockfile-upload"

script:
- docker run -it -v "$(pwd)":/usr/app -w /usr/app r3ddox/node-pdftk:10.9.0 npm test

deploy:
  - provider: script
    script: scripts/deploy-staging.sh $HEROKU_TOKEN
    skip_cleanup: true
    on:
      branch: develop
  - provider: script
    script: scripts/deploy.sh $HEROKU_TOKEN
    skip_cleanup: true
    on:
      tags: true
