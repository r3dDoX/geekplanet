sudo: required

services:
- docker
- heroku

env:
  global:
  - secure: f6RQRRQ9SbGVXtrCLBvZ7xHgGybslFLmdSIo5zsDzJaAVjZP2rUAI+RT6XGhgvOgBOZaRgydSKfmKnKFfHOsi6J6O0mAsSjXOMy5OtLvX1bmivq8i+wOJR+NOCSQnH12Lh/Iwxrcyskq52T+Tmx0EiEPQWAJFQD8ER0LlTZxv4GZ/rXptixsknzKZeMOELG98U8jsL9jCwcJ8Hmr/6sC5v5jV0Qcl4NI8lx9pmas4nACXEYeBwKMBMJQZDqR0ODbS/C8ryL4jmb3ByX3ko4Qpm0GVRUqfNCOWQt2QegVrYmnH6FP+n3uWWBrjUJgjqeuQVhwO7tddQRrjEXpVCL5KXFkB6Cg2crWZRK87+OXADV9k9cFbxouixZny7HsHjEi8Ww3mSetTzQQO/iVBRTsAIIzPpa6cWoXmeUfXCX+2lhLSDKJy0JtyXfeRYr00oKm+HDpFYOWemFrNVNyKlPVLhlQHWeb7shnrae+sZTgcnjsxKp5vJ+eZSXkGvjhYCWkdyR0aoQltbQFJOMULPXsNzlQMtOlOE5kCwsgf1AWmf8i4y4KP1DTnxR+q5wTsD7M9SSYhayLqZd4nb/9oTIlXaSxmixuZYyqDOsgSQskarRuaBQX2neQcAVdP+PGWAhOKni81UITGbnuu5OKUkojtN1MFa1ho2TuiCu/BtNufhA=
  - secure: hC6RSuNDFMGRtuUDKcK1avUUXTbCSURk0WUyIUjTwJ8xbRkTe28vd9Cijbox7iKDJqbmye6Fw2RiHJwGXEFJZCpEAD9UqLg8QEQHvHMzGlS/lvvBiKuo+Bl4vZsyEp6SunyiicaiBohMI9pm89oEH1IGIPG+dU5DXJ928P1HmCec+TTbwfVR/s2Cae2Sd6cjauuXy/HdEg8I3FNiGhixEzG+wZh04gyv6ZeVY7PiZEcLgHCAqZvzXW1n5jLPi+6IEcVnuBa2zZQrpp1VsYenyphhncgRPd8Nqk4+2a1Q6xzoHTa8PHoQ7c9Hr7n+wJ4wbWoANu6/TYYeoMcfyh84Ab/TbRW4CXvAM1Pgmtd5gCcWv3JmsgW/jJxmAWjqWhAZshuEW1Kc9MLCfhc6rVSq8FwjElaRMqwYe9O+rSoP6lJUO6UX6uB3GELcLBJ6xKC6pY1aSg0GyW7ASFAItrPuq/qEEtPonQHmoO7199YQmXQz8TdEHQhSvpuzamZfoueOp2R/7KQ6NTifTU4knurbIA9Mgaj8pqMVcZgVwQuL5oiTozLudfLI6u2qye5Zc6QlBts5lvHt68BdBVri54pF4zmz3q4w86ludyZK80Z1EKc7MYHBow4W8fGGuli5A4pwTMxD5sH78xwfxWaDTFCDsMl1B0bNcgQeuHCzzMdz/Fg=
  - secure: dtynofKruShOc8UroKSIvVYwzG83jfqICFSx38/cpuL54MkcJWCzxBY+XRY5eF4t56gwTmubqPMaGqVHnhn5GKK51Qg58q5K52Psin+LLtxsk3JTAwygMFBYxKraFKnEw1sTaFkVxGbzNdPg+4Woo0nyAfgApYi7FrOSIJ3vZgOEQ2qt+Eapz77Y+bwHSXLfYj/XY4JRDV7fNUUE8gU7cxD9nKxRRYANEqIFouKUUOVjuqaw7DYtErjIupdJpHQZiacRXJsKk+nysOQLX+KUTFYWHBB0Nk8buR9ZHuIR2IE+puC6hJc9v1RzTEGy1GKoVKlEhu+Wrf6EInAtffyPx7eHEtKrpWmzmWGAMm2CHxqhqYMKCZU0ViZN2rD8Z45SmSbp1rVmaBok38PqOgNdLt1vcsCVsbNWRvDT+p8C2RLrg9m/GcE8F5XW3AONg9cJ17D1sWP+dU20K8f5Pvc6+Ny4Y4n3VYcaBpN0Q0SzxI1FD4zf3mMhBn13Du5wlNL01cG0ND1KjqlAT1SVDCp3ZzifLCKTBzFlTR1eM5wNLkKCdZtb+Ar3xSqmqiRvnTJ465g1spE8LS7V0l/GfJcVxBjPPMMAFES5s2oHtHaPd7UhBnKywyHPQp4VkrkPKOKKU1ZVY5x6Ld8bwTwZrLHSOq7NPABTfbIjDa6Zj/dTPQs=

before_install: docker run -it -v "$(pwd)":/usr/app -w /usr/app r3ddox/node-pdftk npm i --silent

before_script: docker run -it -v "$(pwd)":/usr/app -w /usr/app --env-file <(env | grep TRAVIS) r3ddox/node-pdftk npm run greenkeeper_update

after_script: docker run -it -v "$(pwd)":/usr/app -w /usr/app --env GH_TOKEN=$GH_TOKEN --env-file <(env | grep TRAVIS) r3ddox/node-pdftk npm run greenkeeper_upload

script:
- docker run -it -v "$(pwd)":/usr/app -w /usr/app r3ddox/node-pdftk npm test

deploy:
  provider: script
  script: scripts/deploy.sh $HEROKU_USERNAME $HEROKU_PASSWORD
  skip_cleanup: true
  on:
    branch: feature/heroku-docker
