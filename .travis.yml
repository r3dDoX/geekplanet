sudo: required

services:
- docker
- heroku

env:
  global:
  - secure: f6RQRRQ9SbGVXtrCLBvZ7xHgGybslFLmdSIo5zsDzJaAVjZP2rUAI+RT6XGhgvOgBOZaRgydSKfmKnKFfHOsi6J6O0mAsSjXOMy5OtLvX1bmivq8i+wOJR+NOCSQnH12Lh/Iwxrcyskq52T+Tmx0EiEPQWAJFQD8ER0LlTZxv4GZ/rXptixsknzKZeMOELG98U8jsL9jCwcJ8Hmr/6sC5v5jV0Qcl4NI8lx9pmas4nACXEYeBwKMBMJQZDqR0ODbS/C8ryL4jmb3ByX3ko4Qpm0GVRUqfNCOWQt2QegVrYmnH6FP+n3uWWBrjUJgjqeuQVhwO7tddQRrjEXpVCL5KXFkB6Cg2crWZRK87+OXADV9k9cFbxouixZny7HsHjEi8Ww3mSetTzQQO/iVBRTsAIIzPpa6cWoXmeUfXCX+2lhLSDKJy0JtyXfeRYr00oKm+HDpFYOWemFrNVNyKlPVLhlQHWeb7shnrae+sZTgcnjsxKp5vJ+eZSXkGvjhYCWkdyR0aoQltbQFJOMULPXsNzlQMtOlOE5kCwsgf1AWmf8i4y4KP1DTnxR+q5wTsD7M9SSYhayLqZd4nb/9oTIlXaSxmixuZYyqDOsgSQskarRuaBQX2neQcAVdP+PGWAhOKni81UITGbnuu5OKUkojtN1MFa1ho2TuiCu/BtNufhA=
  - secure: C8IE/NVUAsQzZneo/VVK93/OUClOw9u/djwLC6v1K5rragCZUYcgYkpiL3VXqDqbmfuWiD07ylmCXKyEbc+jaYXa5SNe8l+eWW7O5/wxcHS8/0ex6Lz+ErCx3lkDpJDX5V2KK8Qcz0NaC8ywVW2/lmhpFxXhKehI4q3tU22di2dbzcw7EYzvO2T4NmAA+z12MvutqaKhqCBRVH52hSEKQVD+PE2QLMlDqAqHad7tz7/447NunquTaX1mhcv2Z9v5lWjYoa1SBbzpuK64ZwHg2jHxPbbBlbjjmxsX/1cXVwVSoXZRjFEBg7VUWNka+pa+DyLeoTiHFxv0lLpGwrESx7CjhH2lLL4TBlVt4hujW5JZj6/z0OUWGRB3SBl82WJl+DOei06AaKJC6Z9J8Z2p22iW4E5OVG0ijClmLtMM6xHqxd123HqgOXNrgjW9+HnDOXvcn6XJo74ZHOPXvjIJWayrwkYF2xgeBIn+0N04LTjxD6fi39P3g4YviA3FVV+IRKcsYgsx/oWI92hJybVEbkDg/z3KOnR+6H88uOdb9ooop1LlsxfJN1dAxf0WgeAGpOVGRYUDXcDLwTeUxWWKey9B4HokJjm5hZXyrAwodECV/M2MNU8rfdKivXfR9oc9iSO7YH70WfWHbEHWNs/O0lUc58H8yJWgzYa5FexycNY=
  - secure: LeG1X0yMezj2zcwRj4FPLwgG95Ytou9QB+EcBf6sb37MG/jDkAG4JXw1iDrk5t7/+kOQnjOcpQaGA0gjY03uzzfkuj30ick54AKO/BTK1zI8QyRuSoWUjNWqI7XFjnvZHfulBRlEwB6AJD5rUbUSJ+wLDVq3litJsW2TYFmjiD5wvNkspqc5WNbSDzDT9JR/xSvllCYIwxiwNSdU0qMrQNbRGRuCBIFIXptarsrHX0Obe4s+yZ3uqP+vCi/7mzIJb3DUUrLL9stwpjpJ8rvkuAJ0y4ol6rDBZHUkR92lMK8Mq6VfNCNkgo+PYb8NM3E8xrE3AOiJ4JR4+KtXhqOhZPh5IGXBrQV54DoiSH4d+fyjvH1qpCzcytuA+eavrXc4f1Go/cB0/Zo1t8vWXVVo/enqCuLe1d3H7LRycCa9yGnQTovwlIKsohUMIdqHBhd0zfxiLSK1NwVTzJoce+p9bFrO9OvAGf1Qi5i8hMN82NIrZSBzNgNoAKTzyp6IZwHe1V7Ifxe1ouSN2dqW3zQAgiZOSfxgy20vxquHb8JsllDrJRwZDJPjjq3viTndANEWfypcrQqsUVr8dtarU8VUgnE9MiA/KOrDwvsrCgqD0G8M2I1vU0ef6J6SDMNfySaMteB9YqBBXgGMwhRQVqHIpJvuksEbVY/xqfYclyo5tgI=

before_install: docker run -it -v "$(pwd)":/usr/app -w /usr/app r3ddox/node-pdftk npm i --silent

before_script: docker run -it -v "$(pwd)":/usr/app -w /usr/app --env-file <(env |
  grep TRAVIS) r3ddox/node-pdftk npm run greenkeeper_update

after_script: docker run -it -v "$(pwd)":/usr/app -w /usr/app --env GH_TOKEN=$GH_TOKEN --env-file <(env | grep TRAVIS) r3ddox/node-pdftk npm run greenkeeper_upload

script:
- docker run -it -v "$(pwd)":/usr/app -w /usr/app r3ddox/node-pdftk npm test

deploy:
  provider: script
  script: scripts/deploy.sh $HEROKU_USERNAME $HEROKU_PASSWORD
  skip_cleanup: true
  on:
    branch: feature/heroku-docker
